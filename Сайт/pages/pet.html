<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∏—Ç–æ–º—Ü–µ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="../styles/pet.css">

</head>
<body>
    <div id="app">
        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
        <div class="back-button" @click="goBack">‚Üê</div>
        
        <!-- –õ–æ–∞–¥–µ—Ä -->
        <div v-if="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div v-else class="pet-section">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="pet-header">
                <h1 class="pet-name">{{ pet.name }}</h1>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="pet-info-grid">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–∞ —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
                <div class="info-card">
                    <div class="card-title">
                        <i class="fas fa-paw"></i>
                        –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                        <div class="actions">
                            <button v-if="!isEditing" @click="isEditing = true" class="btn btn-primary">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button v-else @click="savePet" class="btn btn-primary">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <!-- –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
                    <div v-if="!isEditing" class="info-fields">
                        <div class="info-item">
                            <div class="info-label">–ò–º—è</div>
                            <div class="info-value">{{ pet.name }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–ü–æ—Ä–æ–¥–∞</div>
                            <div class="info-value">{{ pet.breed || '‚Äî' }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</div>
                            <div class="info-value">{{ formatDate(pet.birth_date) || '‚Äî' }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–ü–æ–ª</div>
                            <div class="info-value">{{ genderLabel(pet.gender) }}</div>
                        </div>
                    </div>
                    
                    <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <div v-else class="edit-form">
                        <div class="form-group">
                            <label>–ò–º—è:</label>
                            <input type="text" v-model="editPet.name">
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø:</label>
                            <select v-model="editPet.type">
                                <option value="–°–æ–±–∞–∫–∞">–°–æ–±–∞–∫–∞</option>
                                <option value="–ö–æ—à–∫–∞">–ö–æ—à–∫–∞</option>
                                <option value="–ì—Ä—ã–∑—É–Ω">–ì—Ä—ã–∑—É–Ω</option>
                                <option value="–ü—Ç–∏—Ü–∞">–ü—Ç–∏—Ü–∞</option>
                                <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ü–æ–ª:</label>
                            <select v-model="editPet.gender">
                                <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                                <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                                <option value="other">–î—Ä—É–≥–æ–π</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
                            <input 
                                type="date" 
                                v-model="editPet.birth_date"
                                :max="new Date().toISOString().split('T')[0]"
                                required
                            >
                        </div>
                        <div class="form-group">
                            <label>–ü–æ—Ä–æ–¥–∞:</label>
                            <input type="text" v-model="editPet.breed">
                        </div>
                    </div>
                </div>

                <!-- –ó–¥–æ—Ä–æ–≤—å–µ -->
                <div class="info-card">
                    <div class="card-title">
                        <i class="fas fa-heartbeat"></i>
                        –ó–¥–æ—Ä–æ–≤—å–µ
                        <div class="actions">
                            <button @click="showDetails('health')" class="btn btn-secondary">
                                üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                            <button @click="showModal('health')" class="btn btn-primary">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div v-if="lastHealthRecord" class="info-item">
                        <div class="info-label">
                            {{ formatDate(lastHealthRecord.record_date) }}
                        </div>
                        <div class="info-value">
                            {{ lastHealthRecord.weight }} –∫–≥
                            <div class="info-note">{{ lastHealthRecord.description }}</div>
                        </div>
                    </div>
                    <div v-else class="info-value">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
                </div>

            <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ –±–ª–æ–∫–æ–≤ -->
            <div class="info-card">
                <div class="card-title">
                    <i class="fas fa-syringe"></i>
                    –ü—Ä–∏–≤–∏–≤–∫–∏
                    <div class="actions">
                        <button @click="showDetails('vaccinations')" class="btn btn-secondary">
                            üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                        <button @click="showModal('vaccinations')" class="btn btn-primary">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                
                <div v-if="lastVaccination" class="info-item">
                    <div class="info-label">{{ lastVaccination.name }}</div>
                    <div class="info-value">
                        {{ formatDate(lastVaccination.date_administered) }}
                        <span v-if="lastVaccination.next_date" class="vaccine-status">
                            <i class="fas fa-redo status-icon"></i>
                            {{ formatDate(lastVaccination.next_date) }}
                        </span>
                    </div>
                </div>
                <div v-else class="info-value">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
            </div>

                <!-- –ö–æ—Ä–º–ª–µ–Ω–∏–µ -->
                <div class="info-card">
                    <div class="card-title">
                        <i class="fas fa-utensils"></i>
                        –ö–æ—Ä–º–ª–µ–Ω–∏–µ
                        <div class="actions">
                            <button @click="showDetails('feeding')" class="btn btn-secondary">
                                üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                            <button @click="showModal('feeding')" class="btn btn-primary">
                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                   
                    <div class="feeding-schedule">
                        <div v-if="lastFeeding" class="feeding-time">
                            <i class="fas fa-clock time-icon"></i>
                            <div>
                                <div class="info-label">{{ formatTime(lastFeeding.feeding_time) }}</div>
                                <div class="info-value">{{ lastFeeding.food_type }} ({{ lastFeeding.quantity }})</div>
                                <div class="info-note" v-if="lastFeeding.notes">{{ lastFeeding.notes }}</div>
                            </div>
                        </div>
                        <div v-else class="info-value">–ì—Ä–∞—Ñ–∏–∫ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</div>
                    </div>
                </div>

            <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
            <div class="info-card">
                <div class="card-title">
                    <i class="fas fa-bell"></i>
                    –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
                    <div class="actions">
                        <button @click="showDetails('reminders')" class="btn btn-secondary">
                          üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                        <button @click="showModal('reminders')" class="btn btn-primary">
                          ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                      </div>
                </div>
                <div class="reminder-card" 
                     v-for="reminder in reminders" 
                     :key="reminder.id"
                     :class="{completed: reminder.is_completed}">
                    <div class="reminder-header">
                        <div class="reminder-date">{{ formatDateTime(reminder.reminder_date) }}</div>
                        <div class="status-indicator" :class="{completed: reminder.is_completed}"></div>
                    </div>
                    <div class="info-value">{{ reminder.description }}</div>
                </div>
                <div v-if="reminders.length === 0" class="info-value">–ù–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div v-if="activeModal" class="modal-overlay">
            <div class="modal-content">
                <component 
                        :is="modalComponent" 
                        :history="currentHistory"    
                        @close="closeModal"  
                        @save="handleSave"
                />
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../scripts/pet.js"></script>
</body>
</html>